import{x as Me,d as We,P as bt,Q as gt,R as Te,r as m,S as ht,o as Ie,w as le,T as Ke,c as be,U as wt,V as xt,W as Ae,b as I,e as A,f as r,X as Ct,Y as St,n as se,Z as _t,$ as Nt,G as kt,C as Ge,a as Ot,u as Pt,a0 as It,a1 as At,k as v,h as J,p as q,l as C,j as b,g as Le,t as f,q as Et,I as jt,y as Ft,F as fe,i as Oe,a2 as qt,s as F}from"./kSsZQJMu.js";import{_ as Ut}from"./CG8kbLfT.js";import{u as Bt}from"./CC2CiqX2.js";import{_ as Rt}from"./DKeeepet.js";import{A as $t,F as B,I as G,a as Tt,C as Lt,b as Vt,_ as zt}from"./CNzEikBg.js";import{O as Dt,P as Ve,f as Mt}from"./vEdr1XBA.js";import{u as Wt,c as Kt}from"./qxOEfmD5.js";import{P as Gt}from"./Dhub1vTp.js";import{L as Ht}from"./yiR-RPDN.js";import{S as Pe}from"./Ce_dQgFj.js";import{T as ze}from"./BdhjvTua.js";import"./DTBgEBQt.js";import"./BvE5FjrA.js";import"./BOho523-.js";import"./OwN-t2v0.js";import"./DfdN0tzT.js";import"./DHPNSSI0.js";import"./DGC7OERx.js";import"./-Md5KaRV.js";import"./D8OkWNTJ.js";import"./DggRlArp.js";import"./bdVkYHui.js";import"./KIWZttzz.js";const V=bt(Ae.ui.strategy,Ae.ui.textarea,_t),Qt=We({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(t){return Object.keys(V.size).includes(t)}},color:{type:String,default:()=>V.default.color,validator(t){return[...Ae.ui.colors,...Object.keys(V.color)].includes(t)}},variant:{type:String,default:()=>V.default.variant,validator(t){return[...Object.keys(V.variant),...Object.values(V.color).flatMap(u=>Object.keys(u))].includes(t)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(t,{emit:u}){const{ui:i,attrs:c}=gt("textarea",Te(t,"ui"),V,Te(t,"class")),{emitFormBlur:y,emitFormInput:h,inputId:x,color:P,size:z,name:E}=Bt(t,V),S=m(ht({},t.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),_=m(null),ue=()=>{var g;t.autofocus&&((g=_.value)==null||g.focus())},Y=()=>{if(t.autoresize){if(!_.value)return;_.value.rows=t.rows;const g=_.value.style.overflow;_.value.style.overflow="hidden";const k=window.getComputedStyle(_.value),X=Number.parseInt(k.paddingTop),Ee=Number.parseInt(k.paddingBottom),pe=X+Ee,he=Number.parseInt(k.lineHeight),{scrollHeight:D}=_.value,M=(D-pe)/he;M>t.rows&&(_.value.rows=t.maxrows?Math.min(M,t.maxrows):M),_.value.style.overflow=g}},ne=g=>{S.value.trim&&(g=g.trim()),S.value.number&&(g=Nt(g)),S.value.nullify&&(g||(g=null)),u("update:modelValue",g),h()},de=g=>{Y(),S.value.lazy||ne(g.target.value)},ie=g=>{const k=g.target.value;u("change",k),S.value.lazy&&ne(k),S.value.trim&&(g.target.value=k.trim())},ce=g=>{u("blur",g),y()};Ie(()=>{setTimeout(()=>{ue()},t.autofocusDelay)}),le(()=>t.modelValue,()=>{Ke(Y)}),Ie(()=>{setTimeout(()=>{ue(),Y()},100)});const ge=be(()=>{var k,X;const g=((X=(k=i.value.color)==null?void 0:k[P.value])==null?void 0:X[t.variant])||i.value.variant[t.variant];return wt(xt(i.value.base,i.value.form,i.value.rounded,i.value.placeholder,i.value.size[z.value],t.padded?i.value.padding[z.value]:"p-0",g==null?void 0:g.replaceAll("{color}",P.value),!t.resize&&"resize-none"),t.textareaClass)});return{ui:i,attrs:c,name:E,inputId:x,textarea:_,textareaClass:ge,onInput:de,onChange:ie,onBlur:ce}}}),Zt=["id","value","name","rows","required","disabled","placeholder"];function Jt(t,u,i,c,y,h){return A(),I("div",{class:se(t.ui.wrapper)},[r("textarea",St({id:t.inputId,ref:"textarea",value:t.modelValue,name:t.name,rows:t.rows,required:t.required,disabled:t.disabled,placeholder:t.placeholder,class:t.textareaClass},t.attrs,{onInput:u[0]||(u[0]=(...x)=>t.onInput&&t.onInput(...x)),onBlur:u[1]||(u[1]=(...x)=>t.onBlur&&t.onBlur(...x)),onChange:u[2]||(u[2]=(...x)=>t.onChange&&t.onChange(...x))}),null,16,Zt),Ct(t.$slots,"default")],2)}const Yt=Object.assign(Me(Qt,[["render",Jt]]),{__name:"UTextarea"}),Xt=kt("/tag.png");/*!
 * paypal-js v8.2.0 (2025-01-23T17:26:53.747Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function er(t,u){var i={};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&u.indexOf(c)<0&&(i[c]=t[c]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,c=Object.getOwnPropertySymbols(t);y<c.length;y++)u.indexOf(c[y])<0&&Object.prototype.propertyIsEnumerable.call(t,c[y])&&(i[c[y]]=t[c[y]]);return i}function tr(t,u){var i=document.querySelector('script[src="'.concat(t,'"]'));if(i===null)return null;var c=He(t,u),y=i.cloneNode();if(delete y.dataset.uidAuto,Object.keys(y.dataset).length!==Object.keys(c.dataset).length)return null;var h=!0;return Object.keys(y.dataset).forEach(function(x){y.dataset[x]!==c.dataset[x]&&(h=!1)}),h?i:null}function rr(t){var u=t.url,i=t.attributes,c=t.onSuccess,y=t.onError,h=He(u,i);h.onerror=y,h.onload=c,document.head.insertBefore(h,document.head.firstElementChild)}function ar(t){var u=t.sdkBaseUrl,i=t.environment,c=er(t,["sdkBaseUrl","environment"]),y=u||sr(i),h=c,x=Object.keys(h).filter(function(E){return typeof h[E]<"u"&&h[E]!==null&&h[E]!==""}).reduce(function(E,S){var _=h[S].toString();return S=or(S),S.substring(0,4)==="data"||S==="crossorigin"?E.attributes[S]=_:E.queryParams[S]=_,E},{queryParams:{},attributes:{}}),P=x.queryParams,z=x.attributes;return P["merchant-id"]&&P["merchant-id"].indexOf(",")!==-1&&(z["data-merchant-id"]=P["merchant-id"],P["merchant-id"]="*"),{url:"".concat(y,"?").concat(lr(P)),attributes:z}}function or(t){var u=function(i,c){return(c?"-":"")+i.toLowerCase()};return t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,u)}function lr(t){var u="";return Object.keys(t).forEach(function(i){u.length!==0&&(u+="&"),u+=i+"="+t[i]}),u}function sr(t){return t==="sandbox"?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js"}function He(t,u){u===void 0&&(u={});var i=document.createElement("script");return i.src=t,Object.keys(u).forEach(function(c){i.setAttribute(c,u[c]),c==="data-csp-nonce"&&i.setAttribute("nonce",u["data-csp-nonce"])}),i}function ur(t,u){if(u===void 0&&(u=Promise),Qe(t,u),typeof document>"u")return u.resolve(null);var i=ar(t),c=i.url,y=i.attributes,h=y["data-namespace"]||"paypal",x=De(h);return y["data-js-sdk-library"]||(y["data-js-sdk-library"]="paypal-js"),tr(c,y)&&x?u.resolve(x):nr({url:c,attributes:y},u).then(function(){var P=De(h);if(P)return P;throw new Error("The window.".concat(h," global variable is not available."))})}function nr(t,u){u===void 0&&(u=Promise),Qe(t,u);var i=t.url,c=t.attributes;if(typeof i!="string"||i.length===0)throw new Error("Invalid url.");if(typeof c<"u"&&typeof c!="object")throw new Error("Expected attributes to be an object.");return new u(function(y,h){if(typeof document>"u")return y();rr({url:i,attributes:c,onSuccess:function(){return y()},onError:function(){var x=new Error('The script "'.concat(i,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return h(x)}})})}function De(t){return window[t]}function Qe(t,u){if(typeof t!="object"||t===null)throw new Error("Expected an options object.");var i=t.environment;if(i&&i!=="production"&&i!=="sandbox")throw new Error('The `environment` option must be either "production" or "sandbox".');if(typeof u<"u"&&typeof u!="function")throw new Error("Expected PromisePonyfill to be a function.")}const dr=()=>{const{$api:t}=Ge();return{getlistOldShippingRule:async i=>{try{return await t("/common/shipping/listOldShippingRule",{method:"POST",body:i})}catch(c){throw c}}}},ir={class:"min-h-screen bg-[#F8F8F8]"},cr={class:"max-w-7xl mx-auto px-4 py-8"},pr={class:"rounded-lg shadow-sm"},vr={class:"flex flex-col lg:flex-row gap-8 items-stretch"},mr={class:"flex-1"},yr={class:"flex-1 space-y-6"},fr={key:0,class:"border border-blackcolor/10 rounded-lg bg-white"},br={class:"border-t border-t-blackcolor/10"},gr={class:"bg-white px-6 py-2 rounded-lg w-2/3"},hr={class:"flex gap-2"},wr={key:1,class:"border border-blackcolor/10 rounded-lg bg-white"},xr={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-y-4 gap-x-4 sm:gap-x-8 border-t border-t-blackcolor/10 p-4 sm:p-6"},Cr={class:"font-medium text-sm sm:text-base"},Sr={class:"font-medium text-sm sm:text-base"},_r={class:"space-y-1 sm:space-y-2"},Nr={class:"px-4 sm:px-6 pb-4 sm:pb-6"},kr={class:"font-medium text-sm sm:text-base"},Or={class:"border border-blackcolor/10 rounded-lg bg-white"},Pr={class:"border-t border-t-blackcolor/10 py-6 px-6"},Ir={class:"text-sm"},Ar={class:"border border-blackcolor/10 rounded-lg bg-white"},Er={class:"grid grid-cols-2 sm:grid-cols-3 gap-6 border-t border-t-blackcolor/10 p-6"},jr=["value"],Fr={class:"flex items-center space-x-2 cursor-pointer"},qr=["src"],Ur={class:"border border-blackcolor/10 rounded-lg bg-white"},Br={class:"border-t border-t-blackcolor/10 py-6 px-8"},Rr={class:"sm:w-80 bg-white rounded-lg shadow-sm flex flex-col justify-between min-h-[200px]"},$r={class:"p-6"},Tr={class:"flex justify-between"},Lr={class:"text-gray-600"},Vr={class:"max-h-96 overflow-y-auto"},zr={class:"flex items-center space-x-4 bg-white rounded-md shadow-sm py-4"},Dr=["src"],Mr={class:"flex flex-col justify-between"},Wr={class:"font-semibold text-sm text-blackcolor truncate-1-lines max-w-52"},Kr={class:"text-gray-300 text-sm my-2 truncate-1-lines max-w-52"},Gr={class:"text-lg font-semibold"},Hr={class:"mt-4"},Qr={class:"flex gap-2 text-white"},Zr={key:0,class:"text-red-500 text-sm mt-1"},Jr={key:0,class:"mt-3 inline-flex items-center px-2 py-1 rounded-md text-xs",style:{"background-color":"#F0F0F0",color:"#333"}},Yr={class:"mr-2 text-xs"},Xr={key:1,class:"flex justify-between mt-4"},ea={class:"text-green-600 font-semibold"},ta={class:"flex justify-between mt-4"},ra={class:"pt-4 flex justify-between font-bold mt-4"},aa={class:"border border-blackcolor/10 rounded-lg"},oa={class:"relative p-3 px-6 text-customblack font-semibold text-lg"},la={class:"grid grid-cols-3 gap-6 border-t border-t-blackcolor/10 p-6"},sa=["onClick"],ua={class:"space-y-1"},na={key:0,class:"absolute top-0 right-0 bg-primary-100 text-primary-600 text-xs px-2 py-0.5 rounded"},da={class:"p-8 flex justify-center"},ia={class:"text-center"},ca=We({__name:"checkout",setup(t){const{getuserAddressRollPage:u,createUserAddress:i}=$t(),{getmapProductByProductSkuList:c}=Gt(),{generateOrderId:y,createOrder:h,getUserOrderDocByOrderNumber:x,tryOrder:P}=Dt(),{getlistOldShippingRule:z}=dr(),{createPayment:E}=Ve(),{listCountryAll:S,listProvinceByCountryId:_,listCityByRegionId:ue}=Ht(),{completePayment:Y,getAvailablePaymentByBindId:ne}=Ve(),de=Ot("locationinfo"),ie=m(0),ce=Wt(),{getCart:ge}=Kt(),g=m(""),k=m(!1),{$showLoading:X,$hideLoading:Ee}=Ge(),pe=m(!1),he=Pt(),D=It(),M=m(""),je=m({}),U=m([]),ve=m([]),W=m(0),H=m(""),K=D.query.from,we=D.query.sku,Ze=D.query.number,Fe=m([]);let xe={};const Je=["+1","+44","+93","+355","+213","+1684","+376","+244","+1264","+1268","+54","+374","+297","+61","+43","+994","+1242","+973","+880","+1246","+375","+32","+501","+229","+1441","+975","+591","+387","+267","+55","+246","+1284","+673","+359","+226","+257","+855","+237","+238","+599","+1345","+236","+235","+56","+86","+57","+269","+243","+242","+682","+506","+225","+385","+53","+599","+357","+420","+45","+253","+1767","+593","+20","+503","+240","+291","+372","+251","+500","+298","+679","+358","+33","+594","+689","+241","+220","+995","+49","+233","+350","+30","+299","+1473","+590","+1671","+502","+44","+224","+245","+592","+509","+504","+852","+36","+354","+91","+62","+98","+964","+353","+972","+39","+1876","+81","+962","+7","+254","+686","+383","+965","+996","+856","+371","+961","+266","+231","+218","+423","+370","+352","+853","+389","+261","+265","+60","+960","+223","+356","+692","+596","+222","+230","+262","+52","+691","+373","+377","+976","+382","+1664","+212","+258","+95","+264","+674","+977","+31","+687","+64","+505","+227","+234","+683","+672","+850","+1670","+47","+968","+92","+680","+970","+507","+675","+595","+51","+63","+48","+351","+974","+262","+40","+7","+250","+590","+290","+1869","+1758","+508","+1784","+685","+378","+239","+966","+221","+381","+248","+232","+65","+1721","+421","+386","+677","+252","+27","+82","+211","+34","+94","+249","+597","+268","+46","+41","+963","+886","+992","+255","+66","+670","+228","+690","+676","+1868","+216","+90","+993","+1649","+688","+1340","+256","+380","+971","+598","+998","+678","+58","+84","+681","+212","+967","+260","+263","+358"],T=m(""),Q=m(""),ee=m(0),te=m(""),me=m(!1),Ye=async()=>{if(Q.value="",!T.value){Q.value="Please enter a coupon code";return}let a=[];U.value.forEach(s=>{a.push({productSku:s.productSku,qtyOrdered:Number(s.qtyOrdered),priceOrdered:s.productPrice,amountOrdered:s.productPrice*Number(s.qtyOrdered)})});let e={buyerCity:d.value.city,buyerCountryCode:d.value.country,buyerCountryName:d.value.countryName,buyerEmail:d.value.email,buyerFirstName:d.value.firstName,buyerAddress:d.value.address,buyerLastName:d.value.lastName,buyerNotes:ae.value,buyerPhoneAreaCode:d.value.numberCode,buyerPhoneNumber:d.value.number,buyerPostalCode:d.value.postalCode,buyerStateOrProvince:d.value.province,id:W.value,shippingRuleFeeId:j.value,shippingRule:{calFee:Z.value},create:!1,orderItemList:a,marketingActivityCouponCode:T.value};me.value=!0;try{let s=await P(e);s.result?(te.value=T.value,ee.value=s.result.marketingActivityDiscountAmount||0,T.value=""):Q.value=s.message||"Invalid coupon code"}catch(s){let l=JSON.parse(s.message);Q.value=l.enDesc||"Failed to apply coupon"}finally{me.value=!1}},Xe=()=>{te.value="",ee.value=0},qe=async()=>{try{let a={skuList:ve.value},s=(await c(a)).result;for(const l in s){let p=s[l];U.value.push({productName:p.erpProduct.productEnglishName,mainPic:p.erpProduct.mainPic,productSku:l,specAttr:p.skuSpec.specAttr,qtyOrdered:xe[l],productPrice:p.skuSpec.customPrice,productStyle:p.erpProduct.productStyle})}Se()}catch{}},Ce=(a,e)=>e.label.toLowerCase().includes(a.toLowerCase()),Se=async()=>{if(K!="order")try{let a=[];U.value.forEach(p=>{a.push({productRealSku:p.productStyle,sku:p.productSku,num:Number(p.qtyOrdered)})});let e={};if(n.value.country&&(e.country=n.value.country),d.value.country&&(e.country=d.value.country),!e.country||a.length==0)return;let l=await z({detailList:a,address:e});l.result.length>0?($.value=l.result,$.value.forEach(p=>{p.label=`${p.feeEnName}　　${p.daysFrom}–${p.daysTo} days　　$${p.calFee.toFixed(2)}`})):$.value=[{feeId:-1,label:"The current country does not support delivery, please change the delivery address",calFee:0}],j.value=$.value[0].feeId}catch{}},et=async()=>{let a=D.query.orderNo;M.value=a;try{let l=(await x({orderNumber:a})).result;je.value=l,W.value=l.id;let p=l.orderItemList;U.value=[],p.forEach(w=>{U.value.push({productName:w.productName,mainPic:w.productImage,productSku:w.productSku,qtyOrdered:w.qtyOrdered,productPrice:w.priceOrdered,productStyle:""})}),d.value.city=l.buyerCity,d.value.country=l.buyerCountryCode,d.value.countryName=l.buyerCountryName,d.value.email=l.buyerEmail,d.value.firstName=l.buyerFirstName,d.value.address=l.buyerAddress,d.value.lastName=l.buyerLastName,ae.value=l.buyerNotes,d.value.numberCode=l.buyerPhoneAreaCode,d.value.number=l.buyerPhoneNumber,d.value.postalCode=l.buyerPostalCode,d.value.province=l.buyerStateOrProvince,R.value=[d],$.value=[l.shippingRule],$.value.forEach(w=>{w.label=`${w.feeEnName}　　${w.daysFrom}–${w.daysTo} days　　$${w.calFee.toFixed(2)}`}),j.value=l.shippingRule.feeId}catch{}},tt=async()=>{try{let a=D.query.ids;typeof a=="string"&&(a=a.split(","));let s=(await ge()).result;Array.isArray(a)&&a.length>0&&(s=s.filter(l=>a.includes(String(l.id)))),Fe.value=s,ve.value=[],s.forEach(l=>{ve.value.push(l.productSku),xe[l.productSku]=l.productQuantity}),qe()}catch(a){console.error("getCart error:",a)}};we&&(ve.value=[we],xe[we]=Ze,qe()),K=="cart"&&tt(),K=="order"&&et();const re=m(!1),_e=m(!1),rt=[{value:1,label:"paypal",icon:"/images/paypal.png"}],n=m({firstName:"",lastName:"",address:"",postalCode:"",country:null,province:null,city:"",numberCode:"+1",number:"",email:"",master:!0}),ae=m(""),Ne=m(1),ye=m([]),ke=m([]),Ue=m([]),R=m([]),j=m(0),$=m([]);m({});const at=()=>{re.value=!0},d=m({}),Be=async()=>{try{let s=(await u({})).result.records;s.length>0&&(s[0].selected=!0,d.value=s[0]),s.filter(l=>l.master=="1").forEach(l=>{l.selected=!0,d.value=l}),R.value=s}catch{}},ot=async()=>{try{let s=(await u({})).result.records;s.forEach(p=>{p.selected=!1});const l=s[s.length-1];l.selected=!0,d.value=l,R.value=s}catch{}},lt=()=>{_e.value=!0};function st(a){return a&&typeof a=="object"&&!Array.isArray(a)&&Object.keys(a).length===0}const ut=async()=>{var s;if(!n.value.firstName)return F.error("firstName is required"),null;if(!n.value.country)return F.error("country is required"),null;if(!n.value.province)return F.error("province is required"),null;if(!n.value.city)return F.error("city is required"),null;if(!n.value.address)return F.error("address is required"),null;if(!n.value.postalCode)return F.error("postalCode is required"),null;if(!n.value.number)return F.error("PhoneNumber is required"),null;const a=((s=ye.value.find(l=>l.countryCode===n.value.country))==null?void 0:s.countryName)||"";let e={fullName:n.value.firstName,firstName:n.value.firstName,lastName:n.value.lastName,address:n.value.address,city:n.value.city,country:n.value.country,master:1,province:n.value.province,postalCode:n.value.postalCode,number:n.value.number,numberCode:n.value.numberCode,email:n.value.email,countryName:a,provinceName:n.value.province};return await i(e),!0},Re=async()=>{try{if(st(d.value)){if(!await ut())return;d.value=n.value,Be()}if(!d.value.address)return F.error("Please add a address"),null;if(j.value<0)return F.error("The current country does not support delivery, please change the delivery address"),null;if(!j.value)return F.error("Shipping methods is required"),null;if(U.value.length>0){if(W.value){if(!H.value){let a={payType:"paypal",createSource:"orderPay",bindIdList:[W.value]},p=(await E(a)).result.payPalResult.payPalOrder.id;return H.value=p,p}}else{let a=await y();W.value=a.result}return pe.value=!0,H.value?H.value:nt()}}catch(a){throw F.error(a.message||"Failed to create order, please try again later"),a}},nt=async()=>{let a=[];U.value.forEach(s=>{a.push({productSku:s.productSku,qtyOrdered:Number(s.qtyOrdered),priceOrdered:s.productPrice,amountOrdered:s.productPrice*Number(s.qtyOrdered)})});let e={buyerCity:d.value.city,buyerCountryCode:d.value.country,buyerCountryName:d.value.countryName,buyerEmail:d.value.email,buyerFirstName:d.value.firstName,buyerAddress:d.value.address,buyerLastName:d.value.lastName,buyerNotes:ae.value,buyerPhoneAreaCode:d.value.numberCode,buyerPhoneNumber:d.value.number,buyerPostalCode:d.value.postalCode,buyerStateOrProvince:d.value.province,id:W.value,shippingRuleFeeId:j.value,shippingRule:{calFee:Z.value},create:!0,orderItemList:a,marketingActivityCouponCode:te.value};if(K=="cart"){let s=[];Fe.value.forEach(l=>{s.push(l.id)}),e.choiceUserShoppingCartIdList=s}try{let s=await h(e);M.value=s.result.orderNumber,ce.refreshCart();let l={payType:"paypal",createSource:"orderPay",bindIdList:[W.value]},O=(await E(l)).result.payPalResult.payPalOrder.id;return H.value=O,O}catch(s){console.log(s);let l=JSON.parse(s.message);(l.errorKey=="calFee"||l.errorKey=="priceOrdered"||l.errorKey=="amountOrdered")&&(g.value=l.enDesc,k.value=!0),pe.value=!1,F.error(l.enDesc||"Order failed")}},dt=a=>{R.value.forEach(e=>{e.selected=!1}),R.value[a].selected=!0,d.value=R.value[a],Z.value=0,re.value=!1};Be();const Z=m(0);be(()=>ce.itemList.filter(a=>a.selected));const $e=be(()=>U.value.reduce((a,e)=>a+e.productPrice*e.qtyOrdered,0)??0),it=be(()=>U.value.reduce((a,e)=>a+Number(e.qtyOrdered),0)),ct=async()=>{try{let e=(await S()).result;ye.value=e,mt()}catch{}},pt=async()=>{let a=ye.value.find(l=>l.countryCode===n.value.country),e=a.phone,s=a.id;n.value.numberCode=e;try{let w=(await _({countryId:s})).result;ke.value=w}catch{}},vt=async()=>{try{let s={regionId:ke.value.find(w=>w.regionName===n.value.province).id},p=(await ue(s)).result;Ue.value=p}catch{}},mt=async()=>{if(de.value){const a=de.value.countryCode;n.value.country!==a&&(n.value.country=null,await Ke(),n.value.country=a)}};m([]),le(()=>d.value,(a,e)=>{a&&Se()}),le(()=>n.value.country,(a,e)=>{a&&(Se(),pt())}),le(()=>n.value.province,(a,e)=>{a&&vt()}),le(()=>j.value,(a,e)=>{a&&$.value.filter(s=>s.feeId==j.value).forEach(s=>{Z.value=s.calFee})});const yt=async a=>{try{let s=await Y({payPalOrderId:a})}catch{}};Ie(async()=>{ct();const a=At(),e=await ur({clientId:a.public.paypalClientId,currency:"USD"});e?e.Buttons({onClick:async(s,l)=>{var p,w,L;try{let O;if(K==="order"){const o={createSource:"orderPay",bindId:je.value.id},N=await ne(o);(L=(w=(p=N==null?void 0:N.result)==null?void 0:p.payPalResult)==null?void 0:w.payPalOrder)!=null&&L.id?O=N.result.payPalResult.payPalOrder.id:O=await Re()}else O=await Re();return O?(ie.value=O,l.resolve()):(console.error("无法获取有效的支付ID"),l.reject())}catch(O){return console.error("支付准备失败:",O),l.reject()}},createOrder:()=>Promise.resolve(String(ie.value)),onApprove(s,l){return l.order.capture().then(p=>{var N,oe;H.value="",(oe=(N=p.purchase_units)==null?void 0:N[0])==null||oe.reference_id;const w=p.id;p.payer.name.given_name;const L=p.purchase_units[0].amount.value,O=p.purchase_units[0].amount.currency_code,o=Mt(p.purchase_units[0].payments.captures[0].create_time);yt(w),he.push({path:"/paysuccess",query:{orderNo:M.value,createTime:o,currency:O,paymentMethod:"PayPal",totalAmount:L}})})},onError(s){console.error("❌ PayPal SDK 出错：",s)}}).render("#paypal-button-container"):console.error("PayPal SDK failed to load.")});function ft(){window.location.reload()}return(a,e)=>{const s=Ft,l=jt,p=Ut,w=Yt,L=Rt,O=zt;return A(),I(fe,null,[r("div",ir,[r("div",cr,[r("div",pr,[r("div",vr,[r("div",mr,[r("main",yr,[R.value.length==0?(A(),I("section",fr,[e[23]||(e[23]=r("div",{class:"p-3 px-6 text-customblack font-semibold text-lg"},[q("Address "),r("span",{style:{color:"red"}},"*")],-1)),r("div",br,[r("div",gr,[v(b(Vt),{layout:"vertical"},{default:C(()=>[v(b(B),{name:"country"},{default:C(()=>[v(b(Pe),{value:n.value.country,"onUpdate:value":e[0]||(e[0]=o=>n.value.country=o),"show-search":"",options:ye.value.map(o=>({label:o.countryName,value:o.countryCode})),placeholder:"Select Country/Region","filter-option":Ce,allowClear:""},null,8,["value","options"])]),_:1}),v(b(B),null,{default:C(()=>[v(b(G),{value:n.value.firstName,"onUpdate:value":e[1]||(e[1]=o=>n.value.firstName=o),placeholder:"First name",size:"large"},null,8,["value"])]),_:1}),v(b(B),null,{default:C(()=>[v(b(G),{value:n.value.lastName,"onUpdate:value":e[2]||(e[2]=o=>n.value.lastName=o),placeholder:"Last name",size:"small"},null,8,["value"])]),_:1}),v(b(B),null,{default:C(()=>[v(b(G),{value:n.value.address,"onUpdate:value":e[3]||(e[3]=o=>n.value.address=o),placeholder:"Street address"},null,8,["value"])]),_:1}),v(b(B),{name:"province"},{default:C(()=>[v(b(Pe),{allowClear:"",value:n.value.province,"onUpdate:value":e[4]||(e[4]=o=>n.value.province=o),"show-search":"",options:ke.value.map(o=>({label:o.regionName,value:o.regionName})),placeholder:"Select State/Province","filter-option":Ce},null,8,["value","options"])]),_:1}),v(b(B),{name:"city"},{default:C(()=>[v(b(Tt),{allowClear:"",value:n.value.city,"onUpdate:value":e[5]||(e[5]=o=>n.value.city=o),"show-search":"",options:Ue.value.map(o=>({label:o.cityName,value:o.cityName})),"filter-option":Ce,placeholder:"Select City"},null,8,["value","options"])]),_:1}),v(b(B),null,{default:C(()=>[v(b(G),{value:n.value.postalCode,"onUpdate:value":e[6]||(e[6]=o=>n.value.postalCode=o),placeholder:"Zip code"},null,8,["value"])]),_:1}),v(b(B),null,{default:C(()=>[v(b(G),{value:n.value.email,"onUpdate:value":e[7]||(e[7]=o=>n.value.email=o),placeholder:"Email(optional)"},null,8,["value"])]),_:1}),v(b(B),null,{default:C(()=>[r("div",hr,[v(b(Pe),{value:n.value.numberCode,"onUpdate:value":e[8]||(e[8]=o=>n.value.numberCode=o),class:"!w-24","show-search":"",options:Je.map(o=>({label:o,value:o}))},null,8,["value","options"]),v(b(G),{value:n.value.number,"onUpdate:value":e[9]||(e[9]=o=>n.value.number=o),placeholder:"Your number",class:"flex-1"},null,8,["value"])])]),_:1}),v(b(B),null,{default:C(()=>[v(b(Lt),{checked:n.value.master,"onUpdate:checked":e[10]||(e[10]=o=>n.value.master=o)},{default:C(()=>e[22]||(e[22]=[q("Set as default address ")])),_:1,__:[22]},8,["checked"])]),_:1})]),_:1})])])])):J("",!0),R.value.length>0?(A(),I("section",wr,[e[27]||(e[27]=r("div",{class:"p-3 px-4 sm:px-6 text-customblack font-semibold text-base sm:text-lg"},[q(" Address "),r("span",{class:"text-red-500"},"*")],-1)),r("div",xr,[r("div",null,[e[24]||(e[24]=r("span",{class:"text-blackcolor/50 text-sm mb-1 block"},"Full name",-1)),r("div",Cr,f(d.value.firstName)+f(d.value.lastName),1)]),r("div",null,[e[25]||(e[25]=r("span",{class:"text-blackcolor/50 text-sm mb-1 block"},"Number",-1)),r("div",Sr,"("+f(d.value.numberCode)+") "+f(d.value.number),1)]),Le(r("div",_r,[r("div",{class:"text-primary cursor-pointer text-sm sm:text-base",onClick:e[11]||(e[11]=o=>at())}," Change another address "),r("div",{class:"text-primary cursor-pointer text-sm sm:text-base",onClick:e[12]||(e[12]=o=>lt())}," Add new address ")],512),[[Et,b(K)!="order"]])]),r("div",Nr,[e[26]||(e[26]=r("span",{class:"text-blackcolor/50 text-sm mb-1 block"},"Address detail",-1)),r("div",kr,f(d.value.countryName)+" "+f(d.value.provinceName)+" "+f(d.value.city)+" "+f(d.value.address),1)])])):J("",!0),r("section",Or,[e[28]||(e[28]=r("div",{class:"p-3 px-6 text-customblack font-semibold text-lg"},[q("Shipping methods "),r("span",{style:{color:"red"}},"*")],-1)),r("div",Pr,[v(p,{modelValue:j.value,"onUpdate:modelValue":e[13]||(e[13]=o=>j.value=o),options:$.value,"option-attribute":"label","value-attribute":"feeId",ui:{rounded:"rounded-md",option:{padding:"px-2 py-2",base:"py-2"}},disabled:b(K)=="order"||j.value=="-1"},{default:C(({open:o})=>[v(l,{size:"lg",color:"white",variant:"outline",class:se(["w-full justify-between h-10 rounded-md",{"ring-2 ring-primary":o}])},{default:C(()=>{var N;return[r("span",Ir,f(((N=$.value.find(oe=>oe.feeId===j.value))==null?void 0:N.label)||"Select Shipping Method"),1),v(s,{name:"i-heroicons-chevron-down"})]}),_:2},1032,["class"])]),_:1},8,["modelValue","options","disabled"])])]),r("section",Ar,[e[29]||(e[29]=r("div",{class:"p-3 px-6 text-customblack font-semibold text-lg"},[q("Payment methods "),r("span",{style:{color:"red"}},"*")],-1)),r("div",Er,[(A(),I(fe,null,Oe(rt,o=>r("div",{key:o.value,class:se(["flex items-center space-x-4 p-2 rounded-md",Ne.value===o.value?"border-2 border-gray-200":"border border-transparent"])},[Le(r("input",{type:"radio",value:o.value,"onUpdate:modelValue":e[14]||(e[14]=N=>Ne.value=N),class:"form-radio"},null,8,jr),[[qt,Ne.value]]),r("label",Fr,[r("img",{src:o.icon,class:"h-8 sm:h-[50px]"},null,8,qr)])],2)),64))])]),r("section",Ur,[e[30]||(e[30]=r("div",{class:"p-3 px-6 text-customblack font-semibold text-lg"},"Notes",-1)),r("div",Br,[v(w,{modelValue:ae.value,"onUpdate:modelValue":e[15]||(e[15]=o=>ae.value=o)},null,8,["modelValue"])])])])]),r("div",Rr,[r("div",$r,[r("div",Tr,[r("span",Lr,"Selected "+f(it.value)+" items",1),r("span",null,"$"+f($e.value.toFixed(2)),1)]),r("div",Vr,[(A(!0),I(fe,null,Oe(U.value,o=>(A(),I("div",zr,[r("img",{src:o.mainPic,alt:"Product Image",class:"w-20 h-20 rounded-md object-cover"},null,8,Dr),r("div",Mr,[v(b(ze),{color:"white",overlayInnerStyle:{color:"#333"},title:o.productName,overlayStyle:{maxWidth:"300px",whiteSpace:"pre-line",wordBreak:"break-word"}},{default:C(()=>[r("div",Wr,f(o.productName),1)]),_:2},1032,["title"]),v(b(ze),{color:"white",overlayInnerStyle:{color:"#333"},title:o.specAttr,overlayStyle:{maxWidth:"300px",whiteSpace:"pre-line",wordBreak:"break-word"}},{default:C(()=>[r("div",Kr,f(o.specAttr),1)]),_:2},1032,["title"]),r("p",Gr,f(o.productPrice)+" x "+f(o.qtyOrdered),1)])]))),256))]),r("div",Hr,[r("div",Qr,[v(b(G),{value:T.value,"onUpdate:value":e[16]||(e[16]=o=>T.value=o),placeholder:"Enter the coupon code",class:"flex-1 border border-gray-300 focus:border-blue-500 focus:ring-blue-500"},null,8,["value"]),v(l,{onClick:Ye,disabled:!T.value||me.value,loading:me.value,class:se(["shrink-0 rounded px-4 text-white",[T.value?"bg-primary hover:bg-[#00a9d8]":"!bg-gray-300 cursor-not-allowed"]])},{default:C(()=>e[31]||(e[31]=[q(" Apply ")])),_:1,__:[31]},8,["disabled","loading","class"])]),Q.value?(A(),I("div",Zr,f(Q.value),1)):J("",!0)]),te.value?(A(),I("div",Jr,[e[32]||(e[32]=r("img",{src:Xt,class:"w-4 h-4 mr-2"},null,-1)),r("span",Yr,f(te.value),1),v(s,{name:"i-material-symbols-close-rounded",class:"w-4 h-4 text-gray-100 hover:text-red-500 cursor-pointer",onClick:Xe})])):J("",!0),ee.value>0?(A(),I("div",Xr,[e[33]||(e[33]=r("span",{class:"text-gray-600"},"Discount",-1)),r("span",ea,"- $"+f(ee.value.toFixed(2)),1)])):J("",!0),r("div",ta,[e[34]||(e[34]=r("span",{class:"text-gray-600"},"Shipping",-1)),r("span",null,"$"+f(Z.value.toFixed(2)),1)]),r("div",ra,[e[35]||(e[35]=r("span",null,"Total",-1)),r("span",null,"$"+f((($e.value||0)+(Z.value||0)-ee.value).toFixed(2)),1)])]),e[36]||(e[36]=r("div",{id:"paypal-button-container",class:"sticky bottom-1 px-2"},null,-1))])])])])]),v(L,{modelValue:re.value,"onUpdate:modelValue":e[18]||(e[18]=o=>re.value=o),width:"w-full",ui:{width:"sm:max-w-5xl"}},{default:C(()=>[r("section",aa,[r("div",oa,[e[37]||(e[37]=q(" Address ")),r("button",{onClick:e[17]||(e[17]=o=>re.value=!1),class:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 px-2 py-1"}," ✕ ")]),r("div",la,[(A(!0),I(fe,null,Oe(R.value,(o,N)=>(A(),I("div",{key:N,class:se(["relative border border-blackcolor/10 rounded-lg p-4 hover:shadow cursor-pointer",{"border-primary-500 bg-primary-50":o.selected==1}]),onClick:oe=>dt(N)},[r("div",ua,[r("p",null,[e[38]||(e[38]=r("span",{class:"text-gray-500"},"Full name:",-1)),q(" "+f(o.firstName)+f(o.lastName),1)]),r("p",null,[e[39]||(e[39]=r("span",{class:"text-gray-500"},"Number:",-1)),q("("+f(o.numberCode)+") "+f(o.number),1)]),r("p",null,[e[40]||(e[40]=r("span",{class:"text-gray-500"},"Address:",-1)),q(" "+f(o.countryName)+" "+f(o.provinceName)+" "+f(o.city)+" "+f(o.address),1)])]),o.selected==1?(A(),I("span",na," Selected ")):J("",!0)],10,sa))),128))])])]),_:1},8,["modelValue"]),v(L,{modelValue:k.value,"onUpdate:modelValue":e[19]||(e[19]=o=>k.value=o)},{default:C(()=>[r("div",da,[r("div",ia,[r("div",null,f(g.value),1),v(l,{class:"mt-6 rounded",onClick:ft},{default:C(()=>e[41]||(e[41]=[q("Refresh")])),_:1,__:[41]})])])]),_:1},8,["modelValue"]),v(O,{isshow:_e.value,onClose:e[20]||(e[20]=o=>_e.value=!1),onUpdateData:e[21]||(e[21]=o=>ot())},null,8,["isshow"])],64)}}}),Ua=Me(ca,[["__scopeId","data-v-bdd22a49"]]);export{Ua as default};
